#include <SoftwareSerial.h>
#include <DHT.h>

// ------------------ HC-12 ------------------
SoftwareSerial hc12(2, 3);   // RX, TX

// ------------------ PINS ------------------
#define SMOKE_PIN A0
#define BTN1 4
#define BTN2 5
#define BTN3 6
#define BTN4 7
#define DHTPIN 8
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);

void setup() {
  Serial.begin(9600);
  hc12.begin(9600);

  pinMode(BTN1, INPUT_PULLUP);
  pinMode(BTN2, INPUT_PULLUP);
  pinMode(BTN3, INPUT_PULLUP);
  pinMode(BTN4, INPUT_PULLUP);

  dht.begin();
}

void loop() {
  int smoke = analogRead(SMOKE_PIN);

  int b1 = !digitalRead(BTN1);
  int b2 = !digitalRead(BTN2);
  int b3 = !digitalRead(BTN3);
  int b4 = !digitalRead(BTN4);

  int temp = (int)dht.readTemperature();
  int hum  = (int)dht.readHumidity();

  if (isnan(temp) || isnan(hum)) {
    Serial.println("DHT ERROR");
    delay(2000);
    return;
  }

  // -------- SEND DATA TO HC-12 --------
  hc12.print(smoke); hc12.print(",");
  hc12.print(b1); hc12.print(",");
  hc12.print(b2); hc12.print(",");
  hc12.print(b3); hc12.print(",");
  hc12.print(b4); hc12.print(",");
  hc12.print(temp); hc12.print(",");
  hc12.println(hum);

  // -------- DEBUG --------
  Serial.print("Sent: ");
  Serial.print(smoke); Serial.print(" ");
  Serial.print(b1); Serial.print(" ");
  Serial.print(b2); Serial.print(" ");
  Serial.print(b3); Serial.print(" ");
  Serial.print(b4); Serial.print(" ");
  Serial.print(temp); Serial.print(" ");
  Serial.println(hum);

  delay(2000);   // DHT sensor delay
}
